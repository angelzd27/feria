<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registros de Detención</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Registros de Detención</h1>
        <p class="subtitle">Feria San Miguel de Allende 2025</p>

        <div class="upload-section" id="uploadSection">
            <h2>1. Cargar Archivo de Datos (.CSV)</h2>
            <p>Arrastra y suelta tu archivo CSV aquí o haz clic para seleccionar</p>
            <div class="file-input-wrapper">
                <label for="fileInput" class="file-input-label">Seleccionar Archivo CSV</label>
                <input type="file" id="fileInput" accept=".csv,.txt">
            </div>
            <div class="file-name" id="fileName"></div>
            <hr>
            <h2>2. Cargar Fotografías (.jpg, .png)</h2>
            <p>Selecciona todas las imágenes de los detenidos</p>
             <div class="file-input-wrapper">
                <label for="imageInput" class="file-input-label btn-images">Seleccionar Imágenes</label>
                <input type="file" id="imageInput" accept="image/*" webkitdirectory>
            </div>
            <div class="file-name" id="imageCount"></div>
            <div class="info-message">
                <strong>Formato esperado del CSV:</strong><br>
                <code>persona, dias_distintos, fechas_detectado, delitos, detalle_delito</code>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="download-section" id="downloadSection">
            <p><strong>Archivo cargado correctamente</strong></p>
            <button class="btn btn-excel" onclick="downloadExcel()">Descargar Excel</button>
            <button class="btn btn-pdf" onclick="downloadPDF()">Descargar PDF</button>
            <button class="btn btn-reset" onclick="resetApp()">Cargar Otros Archivos</button>
        </div>

        <div class="stats" id="stats">
             <div class="stat-card">
                <div class="stat-number" id="totalPersonas">0</div>
                <div class="stat-label">Total de Personas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDetenciones">0</div>
                <div class="stat-label">Total de Detenciones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="promedioDetenciones">0</div>
                <div class="stat-label">Promedio por Persona</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="maxDetenciones">0</div>
                <div class="stat-label">Máximo Detenciones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="faltasAdmin">0</div>
                <div class="stat-label">Faltas Administrativas</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="disposiciones">0</div>
                <div class="stat-label">Disposiciones</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="reincidentes">0</div>
                <div class="stat-label">Reincidentes (3+ días)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="medianaDetenciones">0</div>
                <div class="stat-label">Mediana de Detenciones</div>
            </div>
        </div>

        <div class="section-divider"></div>

        <div class="charts-section" id="chartsSection">
            <div class="carousel-container">
                <button id="prevChartBtn" class="carousel-btn">‹</button>
                <div class="carousel-viewport">
                    <div class="carousel-track" id="carouselTrack">
                        <div class="chart-container">
                            <div class="chart-title">Distribución de Detenciones</div>
                            <canvas id="distributionChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Top 10 Personas con Más Detenciones</div>
                            <canvas id="topPersonsChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Tipos de Delitos</div>
                            <canvas id="delitosChart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-title">Detenciones por Día de la Semana</div>
                            <canvas id="weekdayChart"></canvas>
                        </div>
                    </div>
                </div>
                <button id="nextChartBtn" class="carousel-btn">›</button>
            </div>
        </div>
        <div class="section-divider"></div>

        <div class="table-controls" id="tableControls">
            <input type="text" id="searchInput" placeholder="Buscar en la tabla...">
        </div>

        <table id="dataTable">
            <thead>
                <tr>
                    <th>Fotografía</th>
                    <th>Persona</th>
                    <th>Días Distintos</th>
                    <th>Fechas Detectado</th>
                    <th>Delitos</th>
                    <th>Detalle del Delito</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
        
        <div class="pagination-controls" id="paginationControls">
            <button id="prevPageBtn">Anterior</button>
            <span id="pageInfo"></span>
            <button id="nextPageBtn">Siguiente</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

    <script src="script.js"></script>
</body>
</html>